{% extends 'dashboard.html.twig' %}

{% set pagetitle = 'Dashboard'|trans %}
{% block title pagetitle %}

{% block breadcrumb %}
    <div class="row">
        <div class="col-lg-12 col-md-12 col-12">
            <div class="border-bottom pb-3 mb-3 d-md-flex align-items-center justify-content-between">
                {% set breadcrumb = [{ "current":(pagetitle) }] %}
                {% include "global/dashboard-breadcrumb.html.twig" with breadcrumb %}
                <div>
                    {% if is_granted('ROLE_VERIFIED') %}
                        <a href="" class="btn btn-primary me-2">{{ 'Create'|trans }}</a>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block content %}
	<div class="row">
		<div class="col-lg-12 col-md-12 col-12 mb-2">
			<div class="d-lg-flex align-items-center justify-content-between">
				<h4 class="mb-0">{{ "Recipes summary"|trans }}</h4>
				<a href="{{ path('dashboard_restaurant_recipe_index') }}" class="btn btn-outline-secondary btn-sm">
					{{ "My recipes"|trans }}
				</a>
			</div>
		</div>
	</div>
	<div class="row">
		<div class="col-md-6 col-xl-3 col-12">
			<div class="card mb-4">
				<div class="card-body">
					<div class="d-flex align-items-center justify-content-between mb-3 lh-1">
						<div>
							<span class="fs-6 text-uppercase fw-semibold ls-md">{{ "Recipes added"|trans }}</span>
						</div>
						<div>
							<span class="bi bi-calendar fs-3 text-primary"></span>
						</div>
					</div>
					<div class="text-center my-4">
						<h1 class="display-3 text-primary mb-0 fw-bold">
                            {# {{ setting.getRecipes({"restaurant": app.user.restaurant.slug, "count": true, "isOnline": "all", "elapsed": "all"}).getQuery().getSingleScalarResult() }} #}
							{{ setting.getRecipes({"count": true, "isOnline": "all", "elapsed": "all"}).getQuery().getSingleScalarResult() }}
						</h1>
					</div>
				</div>
			</div>
		</div>
		<div class="col-md-6 col-xl-3 col-12">
			<div class="card mb-4">
				<div class="card-body">
					<div class="d-flex align-items-center justify-content-between mb-3 lh-1">
						<div>
							<span class="fs-6 text-uppercase fw-semibold ls-md">{{ "Published recipes"|trans }}</span>
						</div>
						<div>
							<span class="bi bi-calendar fs-3 text-primary"></span>
						</div>
					</div>
					<div class="text-center my-4">
						<h1 class="display-3 text-info mb-0 fw-bold">
                            {# {{ setting.getRecipes({"restaurant": app.user.restaurant.slug, "count": true, "isOnline": true, "elapsed": "all"}).getQuery().getSingleScalarResult() }} #}
							{{ setting.getRecipes({"count": true, "isOnline": true, "elapsed": "all"}).getQuery().getSingleScalarResult() }}
						</h1>
					</div>
				</div>
			</div>
		</div>
		<div class="col-md-6 col-xl-3 col-12">
			<div class="card mb-4">
				<div class="card-body">
					<div class="d-flex align-items-center justify-content-between mb-3 lh-1">
						<div>
							<span class="fs-6 text-uppercase fw-semibold ls-md">{{ "Upcoming recipes"|trans }}</span>
						</div>
						<div>
							<span class="bi bi-calendar fs-3 text-primary"></span>
						</div>
					</div>
					<div class="text-center my-4">
						<h1 class="display-3 text-success mb-0 fw-bold">
                            {# {{ setting.getRecipes({"restaurant": app.user.restaurant.slug, "count": true, "isOnline": true, "elapsed": false}).getQuery().getSingleScalarResult() }} #}
							{{ setting.getRecipes({"count": true, "isOnline": true, "elapsed": false}).getQuery().getSingleScalarResult() }}
						</h1>
					</div>
				</div>
			</div>
		</div>
		<div class="col-md-6 col-xl-3 col-12">
			<div class="card mb-4">
				<div class="card-body">
					<div class="d-flex align-items-center justify-content-between mb-3 lh-1">
						<div>
							<span class="fs-6 text-uppercase fw-semibold ls-md">{{ "Recipe dates"|trans }}</span>
						</div>
						<div>
							<span class="bi bi-calendar fs-3 text-primary"></span>
						</div>
					</div>
					<div class="text-center my-4">
						<h1 class="display-3 text-danger mb-0 fw-bold">
                            {# {{ setting.getRecipeDates({"restaurant": app.user.restaurant.slug, "count": true}).getQuery().getSingleScalarResult() }} #}
							{{ setting.getRecipeDates({"count": true}).getQuery().getSingleScalarResult() }}
						</h1>
					</div>
				</div>
			</div>
		</div>
	</div>
    {# {% set recipes = setting.getRecipes({"restaurant": app.user.restaurant.slug,"isOnline": "all", "elapsed": "all", "limit": 3}).getQuery().getResult() %} #}
    {% set recipes = setting.getRecipes({"isOnline": "all", "elapsed": "all", "limit": 3}).getQuery().getResult() %}
	{% if recipes | length > 0 %}
		<div class="row">
			<div class="col-12 mb-4">
				<div class="card">
					{% include "dashboard/shared/recipes/manage-recipes-table.html.twig" with {rows: recipes} %}
				</div>
			</div>
		</div>
	{% endif %}
	<div class="row">
		<div class="col-lg-12 col-md-12 col-12 mb-2">
			<div class="d-lg-flex align-items-center justify-content-between">
				<h4 class="mb-0">{{ "Creators summary"|trans }}</h4>
				<a href="{{ path('dashboard_restaurant_orders') }}" class="btn btn-outline-secondary btn-sm">
					{{ "Manage creators"|trans }}
				</a>
			</div>
		</div>
	</div>
	<div class="row">
		<div class="col-md-6 col-xl-3 col-12">
			<div class="card mb-4">
				<div class="card-body">
					<div class="d-flex align-items-center justify-content-between mb-3 lh-1">
						<div>
							<span class="fs-6 text-uppercase fw-semibold ls-md">{{ "Orders placed"|trans }}</span>
						</div>
						<div>
							<span class="bi bi-arrow-down fs-3 text-primary"></span>
						</div>
					</div>
					<div class="text-center my-4">
						<h1 class="display-3 text-primary mb-0 fw-bold">
                            {# {{ setting.getOrders({"restaurant": app.user.restaurant.slug, "count": true, "status": "all"}).getQuery().getSingleScalarResult() }} #}
                            {{ setting.getOrders({"count": true, "status": "all"}).getQuery().getSingleScalarResult() }}
						</h1>
					</div>
				</div>
			</div>
		</div>
		<div class="col-md-6 col-xl-3 col-12">
			<div class="card mb-4">
				<div class="card-body">
					<div class="d-flex align-items-center justify-content-between mb-3 lh-1">
						<div>
							<span class="fs-6 text-uppercase fw-semibold ls-md">{{ "Paid orders"|trans }}</span>
						</div>
						<div>
							<span class="bi bi-arrow-down fs-3 text-primary"></span>
						</div>
					</div>
					<div class="text-center my-4">
						<h1 class="display-3 text-info mb-0 fw-bold">
                            {# {{ setting.getOrders({"restaurant": app.user.restaurant.slug, "count": true, "status": 1}).getQuery().getSingleScalarResult() }} #}
                            {{ setting.getOrders({"count": true, "status": 1}).getQuery().getSingleScalarResult() }}
						</h1>
					</div>
				</div>
			</div>
		</div>
		<div class="col-md-6 col-xl-3 col-12">
			<div class="card mb-4">
				<div class="card-body">
					<div class="d-flex align-items-center justify-content-between mb-3 lh-1">
						<div>
							<span class="fs-6 text-uppercase fw-semibold ls-md">{{ "Awaiting payment"|trans }}</span>
						</div>
						<div>
							<span class="bi bi-arrow-down fs-3 text-primary"></span>
						</div>
					</div>
					<div class="text-center my-4">
						<h1 class="display-3 text-success mb-0 fw-bold">
                            {# {{ setting.getOrders({"restaurant": app.user.restaurant.slug, "count": true, "status": 0}).getQuery().getSingleScalarResult() }} #}
                            {{ setting.getOrders({"count": true, "status": 0}).getQuery().getSingleScalarResult() }}
						</h1>
					</div>
				</div>
			</div>
		</div>
		<div class="col-md-6 col-xl-3 col-12">
			<div class="card mb-4">
				<div class="card-body">
					<div class="d-flex align-items-center justify-content-between mb-3 lh-1">
						<div>
							<span class="fs-6 text-uppercase fw-semibold ls-md">{{ "Subscriptions sold"|trans }}</span>
						</div>
						<div>
							<span class="bi bi-ticket fs-3 text-primary"></span>
						</div>
					</div>
					<div class="text-center my-4">
						<h1 class="display-3 text-danger mb-0 fw-bold">
                            {# {% set subscriptionsSold = setting.getOrders({"restaurant": app.user.restaurant.slug, "sumOrderElements": true, "status": 1}).getQuery().getSingleScalarResult() %} #}
                            {% set subscriptionsSold = setting.getOrders({"sumOrderElements": true, "status": 1}).getQuery().getSingleScalarResult() %}
                            {{ subscriptionsSold ? subscriptionsSold : 0 }}
						</h1>
					</div>
				</div>
			</div>
		</div>
	</div>
    <div class="row mb-5">
        <div class="col-xl-8 col-lg-12 col-md-12 col-12">
			<div class="card mb-4">
				<div class="card-header">
					<div>
						<h4 class="mb-0">{{ "Earnings"|trans }}</h4>
					</div>
				</div>
				<div class="card-body">
					<div id="subscriptionsSalesByDateLineChart"></div>
				</div>
			</div>
        </div>
    </div>
    {# {% set orders = setting.getOrders({"restaurant": app.user.restaurant.slug, "status": "all", "limit": 3}).getQuery().getResult() %} #}
    {% set orders = setting.getOrders({"status": "all", "limit": 3}).getQuery().getResult() %}
    {% if orders | length > 0 %}
		<div class="row">
			<div class="col-xl-6 col-lg-12 col-md-12 col-12 mb-4">
				<div class="card">
					{% include "dashboard/shared/order/manage-orders-table.html.twig" with {rows: recipes} %}
				</div>
			</div>
		</div>
	{% endif %}
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript">
        {{ gc_language(app.request.locale) }}
        {% if subscriptionsSalesByDateLineChart is not null %}
            {{ gc_draw(subscriptionsSalesByDateLineChart, 'subscriptionsSalesByDateLineChart') }}
        {% endif %}
    </script>
{% endblock %}
