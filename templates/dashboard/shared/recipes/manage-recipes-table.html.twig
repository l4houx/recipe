<div class="table-responsive overflow-y-hidden">
	<table class="table mb-0 text-nowrap table-hover table-centered">
        {% if header is not defined or header != false %}
            <thead class="">
                <tr>
                    <th>{{ 'Recipe'|trans }}</th>
                    {% if is_granted('ROLE_ADMIN_APPLICATION') %}
                        <th>{{ 'Restaurant'|trans }}</th>
                    {% endif %}
                    <th>{{ 'Category'|trans }}</th>
                    <th>{{ 'Sales'|trans}}</th>
                    <th>{{ 'Status'|trans }}</th>
                    <th>{{ 'Attendance'|trans}}</th>
                    <th></th>
                </tr>
            </thead>
        {% endif %}
		<tbody>
			{% for recipe in rows %}
				<tr>
					<td>
						{% set link = path('recipe', { slug : recipe.slug }) %}
						<div class="d-flex align-items-center">
							<div>
								<a href="{{ link }}" target="_blank" class="text-inherit">
									<img src="{{ recipe.imageName ? asset(recipe.getImagePath) : recipe.getImagePlaceholder }}" alt="{{ recipe.title }}" class="rounded img-4by3-lg">
								</a>
							</div>
							<div class="ms-3">
								<h4 class="mb-1 h5">
									<a href="{{ link }}" data-bs-toggle="tooltip" title="{{ "View recipe"|trans }}" target="_blank" class="text-inherit">
										{{ recipe.title }}
									</a>
                                    <span class="small text-muted ms-1">#{{ recipe.reference }}</span>
								</h4>
								<ul class="list-inline fs-6 mb-0">
									<li class="list-inline-item">
										<span class="align-text-bottom">
											<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clock" viewbox="0 0 16 16">
												<path d="M8 3.5a.5.5 0 0 0-1 0V9a.5.5 0 0 0 .252.434l3.5 2a.5.5 0 0 0 .496-.868L8 8.71V3.5z"></path>
												<path d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zm7-8A7 7 0 1 1 1 8a7 7 0 0 1 14 0z"></path>
											</svg>
										</span>
										<span>{{ recipe.duration | duration }}</span>
									</li>
                                    {% include 'global/level.html.twig' with {content: recipe, small: true} %}
                                    {% if recipe.premium %}
                                        <li class="list-inline-item">
                                            <span class="align-text-bottom">
                                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-award" viewBox="0 0 16 16">
                                                    <path d="M9.669.864 8 0 6.331.864l-1.858.282-.842 1.68-1.337 1.32L2.6 6l-.306 1.854 1.337 1.32.842 1.68 1.858.282L8 12l1.669-.864 1.858-.282.842-1.68 1.337-1.32L13.4 6l.306-1.854-1.337-1.32-.842-1.68zm1.196 1.193.684 1.365 1.086 1.072L12.387 6l.248 1.506-1.086 1.072-.684 1.365-1.51.229L8 10.874l-1.355-.702-1.51-.229-.684-1.365-1.086-1.072L3.614 6l-.25-1.506 1.087-1.072.684-1.365 1.51-.229L8 1.126l1.356.702z"/>
                                                    <path d="M4 11.794V16l4-1 4 1v-4.206l-2.018.306L8 13.126 6.018 12.1z"/>
                                                </svg>
                                            </span>
                                            <span>{{ 'Premium'|trans }}</span>
                                        </li>
                                    {% endif %}
								</ul>
							</div>
						</div>
					</td>
					{% if is_granted('ROLE_ADMIN_APPLICATION') %}
						<td>
							<a href="{{ path('restaurant', { slug : recipe.restaurant.slug }) }}" target="_blank" class="text-inherit" data-bs-toggle="tooltip" title="{{ "View restaurant"|trans }}">{{ recipe.restaurant.name }}</a>
						</td>
					{% endif %}
					<td>
						<span class="text-decoration-none" style="color: {{ recipe.category.color | default('') }}">
							{{ recipe.category.name | default('') }}
						</span>
					</td>
                    <td>
						<div class="clearfix">
							<span class="fw-semibold">
								({{ recipe.getTotalSalesPercentage }}%)
							</span>
							<span class="ms-1 fw-medium">
                                {{ recipe.getTotalOrderElementsQuantitySum }}
								{{ "subscription(s) sold"|trans }}
							</span>
						</div>
                        <div class="d-flex align-items-center">
                            <div class="progress w-100" style="height: 6px">
                                <div class="progress-bar bg-success" role="progressbar" style="width: {{ recipe.getTotalSalesPercentage }}%" aria-valuenow="{{ recipe.getTotalSalesPercentage }}" aria-valuemin="0" aria-valuemax="100"></div>
                            </div>
                            <div class="ms-2"><span>{{ recipe.getTotalSalesPercentage }}%</span></div>
                        </div>
                    </td>
					<td>
						<span class="badge bg-{{ recipe.stringifyStatusClass }}-soft">{{ recipe.stringifyStatus|trans }}</span>
						{% if recipe.deletedAt %}
							<span class="badge bg-danger-soft">
								<i class="bi bi-alarm"></i>
								{{ "Deleted"|trans }}
							</span>
						{% endif %}
					</td>
					<td class="text-center">
						<div class="mx-auto chart-circle chart-circle-xs" data-value="{{ recipe.getTotalCheckInPercentage/100 }}" data-thickness="3">
							<div class="chart-circle-value">{{ recipe.getTotalCheckInPercentage }}%</div>
						</div>
					</td>
					<td>
						<span class="dropdown dropstart">
							<a class="btn-icon btn btn-ghost btn-sm rounded-circle" href="#" role="button" id="Dropdown1" data-bs-toggle="dropdown" data-bs-offset="-20,20" aria-expanded="false">
								<i class="bi bi-three-dots-vertical"></i>
							</a>
							<span class="dropdown-menu" aria-labelledby="Dropdown1" style="">
								<span class="dropdown-header">{{ 'Settings'|trans }}</span>
								<a class="dropdown-item cursor-pointer" data-bs-toggle="modal" data-bs-target="#recipe-{{ recipe.reference }}-dates">
									<i class="bi bi-bar-chart-line dropdown-item-icon"></i>
									{{ 'Statistics'|trans }}
								</a>
                                {% if recipe.hasRecipeDateWithSeatingPlan %}
                                    <a class="dropdown-item cursor-pointer" data-bs-toggle="modal" data-bs-target="#recipe-{{ recipe.reference }}-datesWithSeatingPlan">
                                        <i class="bi bi-bricks dropdown-item-icon"></i>
                                        {{ 'View reserved seats'|trans }}
                                    </a>
                                {% endif %}
								{% if is_granted('ROLE_ADMIN_APPLICATION') %}
                                    <a class="dropdown-item ajax-loading" href="{{ path('dashboard_admin_recipe_details', {slug : recipe.slug}) }}" data-title="{{ recipe.title }}">
                                        <i class="bi bi-file dropdown-item-icon"></i>
                                        {{ 'Details'|trans }}
                                    </a>
                                    <a class="dropdown-item" href="{{ path('dashboard_admin_orders', {recipe : recipe.slug, status: 1}) }}">
                                        <i class="bi bi-people dropdown-item-icon"></i>
                                        {{ 'Attendees'|trans }}
                                    </a>
                                    <a class="dropdown-item" href="{{ path('dashboard_admin_review_index', {recipe : recipe.slug}) }}">
                                        <i class="bi bi-star dropdown-item-icon"></i>
                                        {{ 'Reviews'|trans }}
                                    </a>
                                    {% if recipe.deletedAt %}
                                        <a class="dropdown-item" href="{{ path('dashboard_admin_recipe_restore', { slug : recipe.slug }) }}">
                                            <i class="bi bi-trash-fill dropdown-item-icon"></i>
                                            {{ 'Restore'|trans }}
                                        </a>
                                        <a href="#" onclick="event.preventDefault(); confirm('{{ "Are you sure you want to delete this item?"|trans }}') && document.getElementById('js-recipe-delete-form').submit();" class="dropdown-item">
                                            <i class="bi bi-trash dropdown-item-icon"></i>
                                            {{ 'Delete permanently'|trans }}
                                        </a>
                                        <form id="js-recipe-delete-form" action="{{ path('dashboard_admin_recipe_delete_permanently', { slug : recipe.slug }) }}" method="post" class="">
                                            <input type="hidden" name="_token" value="{{ csrf_token('recipe_deletion_' ~ recipe.slug) }}">
                                            <input type="hidden" name="_method" value="DELETE">
                                        </form>
                                    {% else %}
                                        <a class="dropdown-item" href="{{ path('dashboard_admin_recipe_delete', { slug : recipe.slug }) }}">
                                            <i class="bi bi-alarm dropdown-item-icon"></i>
                                            {{ 'Delete'|trans }}
                                        </a>
                                    {% endif %}
								{% elseif is_granted('ROLE_RESTAURANT') %}
                                    {% if not recipe.isFree %}
                                        <a class="dropdown-item" data-bs-toggle="modal" data-bs-target="#recipe-{{ recipe.reference }}-payout-request">
                                            <i class="bi bi-currency-dollar dropdown-item-icon"></i>
                                            {{ 'Request payout'|trans }}
                                        </a>
                                    {% endif %}
                                    <a class="dropdown-item ajax-loading" href="{{ path('dashboard_restaurant_recipe_details', {slug : recipe.slug}) }}" data-title="{{ recipe.title }}">
                                        <i class="bi bi-file dropdown-item-icon"></i>
                                        {{ 'Details'|trans }}
                                    </a>
                                    <a class="dropdown-item" href="{{ path('dashboard_restaurant_recipe_edit', {slug : recipe.slug}) }}">
                                        <i class="bi bi-pencil dropdown-item-icon"></i>
                                        {{ 'Edit'|trans }}
                                    </a>
                                    <a class="dropdown-item" href="{{ path('dashboard_restaurant_orders', {recipe : recipe.slug, status: 1}) }}">
                                        <i class="bi bi-people dropdown-item-icon"></i>
                                        {{ 'Attendees'|trans }}
                                    </a>
                                    <a class="dropdown-item" href="{{ path('dashboard_restaurant_review_index', {recipe : recipe.slug}) }}">
                                        <i class="bi bi-star dropdown-item-icon"></i>
                                        {{ 'Reviews'|trans }}
                                    </a>
                                    {% if recipe.isOnline == true %}
                                        <a class="dropdown-item" href="{{ path('dashboard_restaurant_recipe_draft', {slug: recipe.slug}) }}">
                                            <i class="bi bi-eye-slash dropdown-item-icon"></i>
                                            {{ "Draft"|trans }}
                                        </a>
                                    {% else %}
                                        <a class="dropdown-item" href="{{ path('dashboard_restaurant_recipe_publish', {slug: recipe.slug}) }}">
                                            <i class="bi bi-eye dropdown-item-icon"></i>
                                            {{ "Publish"|trans }}
                                        </a>
                                    {% endif %}
                                    {% if recipe.deletedAt %}
                                        <a href="#" onclick="event.preventDefault(); confirm('{{ "Are you sure you want to delete this item?"|trans }}') && document.getElementById('js-recipe-delete-form').submit();" class="dropdown-item">
                                            <i class="bi bi-trash dropdown-item-icon"></i>
                                            {{ 'Delete permanently'|trans }}
                                        </a>
                                        <form id="js-recipe-delete-form" action="{{ path('dashboard_restaurant_recipe_delete_permanently', {slug: recipe.slug}) }}" method="post" class="">
                                            <input type="hidden" name="_token" value="{{ csrf_token('recipe_deletion_' ~ recipe.slug) }}">
                                            <input type="hidden" name="_method" value="DELETE">
                                        </form>
                                    {% else %}
                                        <a class="dropdown-item" href="{{ path('dashboard_restaurant_recipe_delete', {slug: recipe.slug}) }}">
                                            <i class="bi bi-alarm dropdown-item-icon"></i>
                                            {{ 'Delete'|trans }}
                                        </a>
                                    {% endif %}
								{% endif %}
							</span>
						</span>
					</td>
				</tr>

                <div class="modal fade" id="recipe-{{ recipe.reference }}-datesWithSeatingPlan" tabindex="-1" role="dialog" aria-labelledby="recipe-{{ recipe.reference }}-datesWithSeatingPlanTitle" aria-hidden="true">
                    <div class="modal-dialog" role="document">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="recipe-{{ recipe.reference }}-datesWithSeatingPlanTitle">
                                    {{ recipe.title }}: {{ "Recipe dates"|trans }}
                                </h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                            </div>
                            <div class="modal-body">
                                {% for recipeDate in recipe.recipedates %}
                                    {% if recipeDate.hasSeatingPlan %}
                                        <div>
                                            <b class="float-start">
                                                {{ recipeDate.startdate | ago }}
                                            </b>
                                            {% if is_granted("ROLE_ADMIN_APPLICATION") %}
                                                <a href="{{ path("dashboard_admin_recipe_date_statistics_reservedSeats", {recipeDateReference: recipeDate.reference, recipeSlug: recipe.slug}) }}" class="float-end">
                                                    {{ "View reserved seats"|trans }}
                                                </a>
                                            {% elseif is_granted("ROLE_RESTAURANT") %}
                                                <a href="{{ path("dashboard_restaurant_recipe_date_statistics_reservedSeats", {recipeDateReference: recipeDate.reference, recipeSlug: recipe.slug}) }}" class="float-end">
                                                    {{ "View reserved seats"|trans }}
                                                </a>
                                            {% endif %}
                                            <div class="clearfix"></div>
                                        </div>
                                    {% endif %}
                                    {% if not loop.last %}<hr>{% endif %}
                                {% endfor %}
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">{{ "Close"|trans }}</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="modal fade" id="recipe-{{ recipe.reference }}-dates" tabindex="-1" role="dialog" aria-labelledby="recipe-{{ recipe.reference }}-datesTitle" aria-hidden="true">
                    <div class="modal-dialog" role="document">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="recipe-{{ recipe.reference }}-datesTitle">
                                    {{ recipe.title }}: {{ "Recipe dates"|trans }}
                                </h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                            </div>
                            <div class="modal-body">
                                {% for recipeDate in recipe.recipedates %}
                                    <div>
                                        <b class="float-start">
                                            {{ recipeDate.startdate | ago }}
                                        </b>
                                        {% if is_granted("ROLE_ADMIN_APPLICATION") %}
                                            <a href="{{ path("dashboard_admin_recipe_date_statistics_index", {recipeDateReference: recipeDate.reference, recipeSlug: recipe.slug}) }}" class="float-end">
                                                {{ "View stats"|trans }}
                                            </a>
                                        {% elseif is_granted("ROLE_RESTAURANT") %}
                                            <a href="{{ path("dashboard_restaurant_recipe_date_statistics__index", {recipeDateReference: recipeDate.reference, recipeSlug: recipe.slug}) }}" class="float-end">
                                                {{ "View stats"|trans }}
                                            </a>
                                        {% endif %}
                                        <div class="clearfix"></div>
                                    </div>
                                    {% if not loop.last %}<hr>{% endif %}
                                {% endfor %}
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">{{ "Close"|trans }}</button>
                            </div>
                        </div>
                    </div>
                </div>

				{% if not recipe.isFree %}
                    <div class="modal fade" id="recipe-{{ recipe.reference }}-payout-request" aria-hidden="true" aria-labelledby="recipe-{{ recipe.reference }}-payout-requestLabel" tabindex="-1">
                        <div class="modal-dialog modal-dialog-centered">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="recipe-{{ recipe.reference }}-payout-requestLabel">
                                        {{ recipe.title }}: {{ "Payout request"|trans }}
                                    </h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>
                                <div class="modal-body">
                                    {% include "global/message.html.twig" with { type: "dark", message: ('Once the payout request submitted, the recipe date will be locked and the sales will be suspended for the specific recipe date. If you wish, you can wait until the start date of the recipe date before requesting the payout. You can cancel the payout request any time before it is processed'|trans), icon: "bi bi-exclamation-circle", class: "my-2" } %}
                                    <hr>
                                    {% for recipeDate in recipe.recipedates %}
                                        {% if not recipeDate.isFree %}
                                            <div>
                                                <b class="float-start">
                                                    {{ recipeDate.startdate | ago }}
                                                </b>
                                                {% if recipeDate.isFree %}
                                                    <span class="badge bg-info float-end">{{ "Free"|trans }}</span>
                                                {% elseif recipeDate.getSales <= 0 %}
                                                    <span class="badge bg-info float-end">{{ "No sales yet"|trans }}</span>
                                                {% elseif recipeDate.payoutRequested %}
                                                    <a href="{{ path("dashboard_restaurant_payout_requests", {recipedate: recipeDate.reference}) }}" class="float-end">
                                                        <i class="fas fa-file-invoice-dollar"></i> {{ "Payout already requested"|trans }}
                                                    </a>
                                                {% else %}
                                                    <a href="{{ path("dashboard_restaurant_recipe_date_request_payout", {recipeDateReference: recipeDate.reference}) }}" class="float-end">
                                                        <i class="fas fa-file-invoice-dollar"></i> {{ "Request payout"|trans }}
                                                    </a>
                                                {% endif %}
                                                <div class="clearfix"></div>
                                            </div>
                                        {% endif %}
                                        {% if not loop.last %}<hr>{% endif %}
                                    {% endfor %}
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">{{ "Close"|trans }}</button>
                                </div>
                            </div>
                        </div>
                    </div>
				{% endif %}
			{% endfor %}
		</tbody>
	</table>
</div>
